<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Support\Facades\DB;

class CreateNrCsrViews extends Migration
{
    public function up()
    {
        // We cannot rely on `search_path` changes across statements because each DB::statement can
        // use a different connection, and Postgres (via PDO) also disallows multiple statements in
        // a single prepared statement. So: fully qualify table names for views that used unqualified
        // references.

        DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_ANGGARAN" AS SELECT "NR_CSR"."TBL_ANGGARAN"."ID_ANGGARAN", "NR_CSR"."TBL_ANGGARAN"."NOMINAL", "NR_CSR"."TBL_ANGGARAN"."TAHUN", "NR_CSR"."TBL_ANGGARAN"."ID_PERUSAHAAN", "NR_CSR"."TBL_PERUSAHAAN"."NAMA_PERUSAHAAN", "NR_CSR"."TBL_PERUSAHAAN"."KODE" FROM "NR_CSR"."TBL_ANGGARAN" INNER JOIN "NR_CSR"."TBL_PERUSAHAAN" ON "NR_CSR"."TBL_ANGGARAN"."ID_PERUSAHAAN" = "NR_CSR"."TBL_PERUSAHAAN"."ID_PERUSAHAAN"');
        DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_BAST" AS SELECT bast."ID_BAST_DANA", sur."BANTUAN_BERUPA", kel."ID_KELAYAKAN", kel."PILAR", kel."DESKRIPSI", kel."PROVINSI", kel."KABUPATEN", lem."NAMA_LEMBAGA", bast."NO_BAST_DANA", bast."NO_BAST_PIHAK_KEDUA", bast."TGL_BAST", sur."NILAI_APPROVED", lem."NAMA_PIC", lem."JABATAN", kel."NO_SURAT", kel."BANTUAN_UNTUK", kel."TGL_SURAT", sur."TERMIN", sur."PERSEN1", sur."PERSEN2", sur."PERSEN3", sur."PERSEN4", sur."RUPIAH1", sur."RUPIAH2", sur."RUPIAH3", sur."RUPIAH4", sur."SURVEI1", kel."NAMA_BANK", kel."ATAS_NAMA", kel."NO_REKENING", bast."JUMLAH_BARANG", bast."NO_PELIMPAHAN", bast."APPROVER_ID", lem."ALAMAT" FROM "NR_CSR"."TBL_BAST_DANA" bast INNER JOIN "NR_CSR"."TBL_KELAYAKAN" kel ON bast."ID_KELAYAKAN" = kel."ID_KELAYAKAN" INNER JOIN "NR_CSR"."TBL_SURVEI" sur ON kel."ID_KELAYAKAN" = sur."ID_KELAYAKAN" INNER JOIN "NR_CSR"."TBL_LEMBAGA" lem ON kel."ID_LEMBAGA" = lem."ID_LEMBAGA"');
        DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_BAST_DANA" AS SELECT "NR_CSR"."TBL_BAST_DANA"."NO_AGENDA", "NR_CSR"."TBL_BAST_DANA"."ID_BAST_DANA", "NR_CSR"."TBL_KELAYAKAN"."ID_KELAYAKAN", "NR_CSR"."TBL_KELAYAKAN"."SEKTOR_BANTUAN", "NR_CSR"."TBL_KELAYAKAN"."PILAR", "NR_CSR"."TBL_KELAYAKAN"."TPB", "NR_CSR"."TBL_BAST_DANA"."BANTUAN_UNTUK", "NR_CSR"."TBL_KELAYAKAN"."DESKRIPSI", "NR_CSR"."TBL_BAST_DANA"."PROPOSAL_DARI", "NR_CSR"."TBL_BAST_DANA"."ALAMAT", "NR_CSR"."TBL_BAST_DANA"."PROVINSI", "NR_CSR"."TBL_BAST_DANA"."KABUPATEN", "NR_CSR"."TBL_BAST_DANA"."PENANGGUNG_JAWAB", "NR_CSR"."TBL_BAST_DANA"."BERTINDAK_SEBAGAI", "NR_CSR"."TBL_BAST_DANA"."NO_SURAT", "NR_CSR"."TBL_BAST_DANA"."TGL_SURAT", "NR_CSR"."TBL_BAST_DANA"."PERIHAL", "NR_CSR"."TBL_BAST_DANA"."PIHAK_KEDUA", "NR_CSR"."TBL_BAST_DANA"."NAMA_BANK", "NR_CSR"."TBL_BAST_DANA"."NO_REKENING", "NR_CSR"."TBL_BAST_DANA"."ATAS_NAMA", "NR_CSR"."TBL_BAST_DANA"."NO_BAST_DANA", "NR_CSR"."TBL_BAST_DANA"."NO_BAST_PIHAK_KEDUA", "NR_CSR"."TBL_BAST_DANA"."TGL_BAST", "NR_CSR"."TBL_BAST_DANA"."NAMA_BARANG", "NR_CSR"."TBL_BAST_DANA"."JUMLAH_BARANG", "NR_CSR"."TBL_BAST_DANA"."SATUAN_BARANG", "NR_CSR"."TBL_BAST_DANA"."NAMA_PEJABAT", "NR_CSR"."TBL_BAST_DANA"."JABATAN_PEJABAT", "NR_CSR"."TBL_BAST_DANA"."CREATED_BY", "NR_CSR"."TBL_BAST_DANA"."CREATED_DATE", "NR_CSR"."TBL_BAST_DANA"."NO_PELIMPAHAN", "NR_CSR"."TBL_BAST_DANA"."TGL_PELIMPAHAN", "NR_CSR"."TBL_BAST_DANA"."STATUS", "NR_CSR"."TBL_BAST_DANA"."APPROVED_BY", "NR_CSR"."TBL_BAST_DANA"."APPROVED_DATE", "NR_CSR"."TBL_SURVEI"."NILAI_APPROVED", "NR_CSR"."TBL_SURVEI"."TERMIN", "NR_CSR"."TBL_SURVEI"."PERSEN1", "NR_CSR"."TBL_SURVEI"."PERSEN2", "NR_CSR"."TBL_SURVEI"."PERSEN3", "NR_CSR"."TBL_SURVEI"."PERSEN4", "NR_CSR"."TBL_SURVEI"."RUPIAH1", "NR_CSR"."TBL_SURVEI"."RUPIAH2", "NR_CSR"."TBL_SURVEI"."RUPIAH3", "NR_CSR"."TBL_SURVEI"."RUPIAH4", "NR_CSR"."TBL_SURVEI"."SURVEI1", "NR_CSR"."TBL_SURVEI"."BANTUAN_BERUPA" FROM "NR_CSR"."TBL_BAST_DANA" JOIN "NR_CSR"."TBL_KELAYAKAN" ON "NR_CSR"."TBL_BAST_DANA"."NO_AGENDA" = "NR_CSR"."TBL_KELAYAKAN"."NO_AGENDA" JOIN "NR_CSR"."TBL_SURVEI" ON "NR_CSR"."TBL_BAST_DANA"."NO_AGENDA" = "NR_CSR"."TBL_SURVEI"."NO_AGENDA"');
        // Depends on external schema/tables (NR_PAYMENT.*) which may not exist in this database.
        // Skip to keep migrations runnable in a standalone NR_CSR database.
        // DB::statement("CREATE OR REPLACE VIEW \"NR_CSR\".\"V_BULAN\" AS SELECT ... FROM NR_PAYMENT.T_INVOICE_LINE ..., NR_PAYMENT.T_PAYMENT_REQUEST ...");
        // Force case-sensitive table names with double-quotes (tables were created as "TBL_*" in the NR_CSR schema).
        DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_DETAIL_APPROVAL" AS SELECT "NR_CSR"."TBL_DETAIL_APPROVAL"."ID", "NR_CSR"."TBL_DETAIL_APPROVAL"."ID_KELAYAKAN", "NR_CSR"."TBL_DETAIL_APPROVAL"."ID_HIRARKI", "NR_CSR"."TBL_DETAIL_APPROVAL"."PHASE", "NR_CSR"."TBL_HIRARKI"."ID_LEVEL", "NR_CSR"."TBL_LEVEL_HIRARKI"."LEVEL", "NR_CSR"."TBL_LEVEL_HIRARKI"."NAMA_LEVEL", "NR_CSR"."TBL_DETAIL_APPROVAL"."ID_USER", "NR_CSR"."TBL_DETAIL_APPROVAL"."CATATAN", "NR_CSR"."TBL_DETAIL_APPROVAL"."STATUS", "NR_CSR"."TBL_DETAIL_APPROVAL"."STATUS_DATE", "NR_CSR"."TBL_DETAIL_APPROVAL"."TASK_DATE", "NR_CSR"."TBL_DETAIL_APPROVAL"."ACTION_DATE" FROM "NR_CSR"."TBL_DETAIL_APPROVAL" INNER JOIN "NR_CSR"."TBL_HIRARKI" ON "NR_CSR"."TBL_DETAIL_APPROVAL"."ID_HIRARKI" = "NR_CSR"."TBL_HIRARKI"."ID" INNER JOIN "NR_CSR"."TBL_LEVEL_HIRARKI" ON "NR_CSR"."TBL_HIRARKI"."ID_LEVEL" = "NR_CSR"."TBL_LEVEL_HIRARKI"."ID"');
        // Unquoted identifiers would be folded to lowercase and won't match our quoted "TBL_*" tables.
        DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_EVALUASI" AS SELECT e."ID_EVALUASI" AS "ID_EVALUASI", k."NO_AGENDA" AS "NO_AGENDA", k."PENGIRIM" AS "PENGIRIM", k."TGL_TERIMA" AS "TGL_TERIMA", k."NO_SURAT" AS "NO_SURAT", k."TGL_SURAT" AS "TGL_SURAT", k."PERIHAL" AS "PERIHAL", k."PENGAJU_PROPOSAL" AS "PENGAJU_PROPOSAL", k."SEBAGAI" AS "SEBAGAI", k."ALAMAT" AS "ALAMAT", k."PROVINSI" AS "PROVINSI", k."KABUPATEN" AS "KABUPATEN", k."BANTUAN_UNTUK" AS "BANTUAN_UNTUK", k."DESKRIPSI" AS "DESKRIPSI", k."JENIS" AS "JENIS", k."ATAS_NAMA" AS "ATAS_NAMA", k."NAMA_PERSON" AS "NAMA_PERSON", k."CONTACT_PERSON" AS "CONTACT_PERSON", k."NILAI_PENGAJUAN" AS "NILAI_PENGAJUAN", k."SEKTOR_BANTUAN" AS "SEKTOR_BANTUAN", k."NILAI_BANTUAN" AS "NILAI_BANTUAN", k."NAMA_ANGGOTA" AS "NAMA_ANGGOTA", k."FRAKSI" AS "FRAKSI", k."JABATAN" AS "JABATAN", k."PIC" AS "PIC", k."ASAL_SURAT" AS "ASAL_SURAT", k."KOMISI" AS "KOMISI", k."SIFAT" AS "SIFAT", k."EMAIL_PENGAJU" AS "EMAIL_PENGAJU", k."MATA_UANG_PENGAJUAN" AS "MATA_UANG_PENGAJUAN", k."MATA_UANG_BANTUAN" AS "MATA_UANG_BANTUAN", e."RENCANA_ANGGARAN" AS "RENCANA_ANGGARAN", k."PROPOSAL" AS "PROPOSAL", e."DOKUMEN" AS "DOKUMEN", e."DENAH" AS "DENAH", e."SYARAT" AS "SYARAT", e."EVALUATOR1" AS "EVALUATOR1", e."CATATAN1" AS "CATATAN1", e."EVALUATOR2" AS "EVALUATOR2", e."CATATAN2" AS "CATATAN2", e."KADEP" AS "KADEP", e."KADIV" AS "KADIV", e."STATUS" AS "STATUS", e."APPROVE_DATE" AS "APPROVE_DATE", e."APPROVE_KADEP" AS "APPROVE_KADEP", e."APPROVE_KADIV" AS "APPROVE_KADIV", e."KET_KADIN1" AS "KET_KADIN1", e."KET_KADIV" AS "KET_KADIV", e."REVISI_BY" AS "REVISI_BY", e."REVISI_DATE" AS "REVISI_DATE", e."REJECT_BY" AS "REJECT_BY", e."REJECT_DATE" AS "REJECT_DATE", e."CREATE_BY" AS "CREATE_BY", e."CREATE_DATE" AS "CREATE_DATE", k."ID_KELAYAKAN" AS "ID_KELAYAKAN", e."SEKPER", e."DIRUT", e."KET_SEKPER", e."KET_DIRUT", e."APPROVE_SEKPER", e."APPROVE_DIRUT" FROM "NR_CSR"."TBL_KELAYAKAN" k JOIN "NR_CSR"."TBL_EVALUASI" e ON e."ID_KELAYAKAN" = k."ID_KELAYAKAN"');
        DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_HIRARKI" AS SELECT "NR_CSR"."TBL_HIRARKI"."ID", "NR_CSR"."TBL_HIRARKI"."ID_USER", "NR_CSR"."TBL_USER"."NAMA", "NR_CSR"."TBL_USER"."USERNAME", "NR_CSR"."TBL_USER"."EMAIL", "NR_CSR"."TBL_USER"."JABATAN", "NR_CSR"."TBL_USER"."FOTO_PROFILE", "NR_CSR"."TBL_HIRARKI"."ID_LEVEL", "NR_CSR"."TBL_LEVEL_HIRARKI"."LEVEL", "NR_CSR"."TBL_LEVEL_HIRARKI"."NAMA_LEVEL", "NR_CSR"."TBL_HIRARKI"."STATUS" FROM "NR_CSR"."TBL_HIRARKI" INNER JOIN "NR_CSR"."TBL_USER" ON "NR_CSR"."TBL_HIRARKI"."ID_USER" = "NR_CSR"."TBL_USER"."ID_USER" INNER JOIN "NR_CSR"."TBL_LEVEL_HIRARKI" ON "NR_CSR"."TBL_HIRARKI"."ID_LEVEL" = "NR_CSR"."TBL_LEVEL_HIRARKI"."ID"');
        DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_INFO_BANK" AS SELECT "NR_CSR"."TBL_KELAYAKAN"."NO_AGENDA", "NR_CSR"."TBL_KELAYAKAN"."ATAS_NAMA", "NR_CSR"."TBL_KELAYAKAN"."NAMA_BANK", "NR_CSR"."TBL_KELAYAKAN"."KODE_BANK", "NR_CSR"."TBL_KELAYAKAN"."KOTA_BANK", "NR_CSR"."TBL_KELAYAKAN"."KODE_KOTA", "NR_CSR"."TBL_KELAYAKAN"."CABANG_BANK" FROM "NR_CSR"."TBL_KELAYAKAN"');
        // Depends on external schema/tables (NR_PAYMENT.*) which may not exist in this database.
        // DB::statement("CREATE OR REPLACE VIEW \"NR_CSR\".\"V_INV_PAYREQUEST\" AS SELECT ... FROM NR_PAYMENT.T_INVOICE_LINE ..., NR_PAYMENT.T_PAYMENT_REQUEST ...");
        DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_JENIS" AS SELECT "NR_CSR"."TBL_KELAYAKAN"."JENIS", COUNT("NR_CSR"."TBL_KELAYAKAN"."JENIS") AS "JUMLAH", TO_CHAR("NR_CSR"."TBL_KELAYAKAN"."TGL_TERIMA", \'YYYY\') as "TAHUN" FROM "NR_CSR"."TBL_KELAYAKAN" GROUP BY "NR_CSR"."TBL_KELAYAKAN"."TGL_TERIMA", "NR_CSR"."TBL_KELAYAKAN"."JENIS"');
        DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_KABUPATEN_KAMBING" AS SELECT "NR_CSR"."TBL_SUB_PROPOSAL"."KABUPATEN" FROM "NR_CSR"."TBL_SUB_PROPOSAL" WHERE "NR_CSR"."TBL_SUB_PROPOSAL"."KAMBING" > 0 GROUP BY "NR_CSR"."TBL_SUB_PROPOSAL"."KABUPATEN"');
        DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_KABUPATEN_SAPI" AS SELECT "NR_CSR"."TBL_SUB_PROPOSAL"."KABUPATEN" FROM "NR_CSR"."TBL_SUB_PROPOSAL" WHERE "NR_CSR"."TBL_SUB_PROPOSAL"."SAPI" > 0 GROUP BY "NR_CSR"."TBL_SUB_PROPOSAL"."KABUPATEN"');
        // Quote identifiers so Postgres doesn't fold them to lowercase (our tables are created quoted).
        DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_KELAYAKAN" AS SELECT "NR_CSR"."TBL_KELAYAKAN"."TGL_TERIMA", "NR_CSR"."TBL_KELAYAKAN"."DESKRIPSI", "NR_CSR"."TBL_KELAYAKAN"."PENGAJU_PROPOSAL", "NR_CSR"."TBL_SURVEI"."NILAI_BANTUAN", "NR_CSR"."TBL_KELAYAKAN"."PILAR" FROM "NR_CSR"."TBL_KELAYAKAN" INNER JOIN "NR_CSR"."TBL_SURVEI" ON "NR_CSR"."TBL_KELAYAKAN"."NO_AGENDA" = "NR_CSR"."TBL_SURVEI"."NO_AGENDA" WHERE TO_CHAR("NR_CSR"."TBL_KELAYAKAN"."TGL_TERIMA", \'YYYY\') = \'2022\' AND "NR_CSR"."TBL_KELAYAKAN"."STATUS" = \'Approved\'');
        // Depends on V_INV_PAYREQUEST (skipped above when NR_PAYMENT tables do not exist)
        // DB::statement("CREATE OR REPLACE VIEW \"NR_CSR\".\"V_NILAI_REALISASI_PROVINSI\" AS select ... from v_inv_payrequest");
        DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_PEKERJAAN" AS SELECT "NR_CSR"."TBL_PEKERJAAN"."PEKERJAAN_ID", "NR_CSR"."TBL_PEKERJAAN"."NAMA_PEKERJAAN", "NR_CSR"."TBL_PEKERJAAN"."RINGKASAN", "NR_CSR"."TBL_PEKERJAAN"."NILAI_PERKIRAAN", "NR_CSR"."TBL_PEKERJAAN"."NILAI_PENAWARAN", "NR_CSR"."TBL_PEKERJAAN"."NILAI_KESEPAKATAN", "NR_CSR"."TBL_PEKERJAAN"."TAHUN", "NR_CSR"."TBL_PEKERJAAN"."PROKER_ID", "NR_CSR"."TBL_PEKERJAAN"."KAK", "NR_CSR"."TBL_PEKERJAAN"."ID_VENDOR", "NR_CSR"."TBL_PROKER"."PROKER", "NR_CSR"."TBL_PROKER"."PRIORITAS", "NR_CSR"."TBL_PROKER"."PILAR", "NR_CSR"."TBL_PROKER"."GOLS", "NR_CSR"."TBL_PEKERJAAN"."STATUS", "NR_CSR"."TBL_PEKERJAAN"."CREATED_BY", "NR_CSR"."TBL_PEKERJAAN"."CREATED_DATE" FROM "NR_CSR"."TBL_PEKERJAAN" INNER JOIN "NR_CSR"."TBL_PROKER" ON "NR_CSR"."TBL_PEKERJAAN"."PROKER_ID" = "NR_CSR"."TBL_PROKER"."ID_PROKER"');
        DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_PEMBAYARAN" AS SELECT P."ID_PEMBAYARAN", P."TERMIN", P."NILAI_APPROVED", P."STATUS", P."PR_ID", P."CREATE_DATE", P."CREATE_BY", P."EXPORT_DATE", P."EXPORT_BY", P."ID_KELAYAKAN", P."DESKRIPSI" AS "DESKRIPSI_PEMBAYARAN", P."FEE", P."JUMLAH_PEMBAYARAN", P."SUBTOTAL", K."NO_AGENDA", K."TGL_TERIMA", K."PROVINSI", K."KABUPATEN", K."KECAMATAN", K."KELURAHAN", K."BANTUAN_UNTUK", K."NAMA_BANK", K."ATAS_NAMA", K."NO_REKENING", K."PERIHAL", K."JENIS", K."DESKRIPSI", K."ID_LEMBAGA", L."NAMA_LEMBAGA", K."ID_PROKER", PR."PROKER", PR."TAHUN", PR."PILAR", PR."KODE_TPB", PR."GOLS", PR."PRIORITAS", S."APPROVE_KADIV" AS "APPROVE_DATE", P."METODE" FROM "NR_CSR"."TBL_PEMBAYARAN" P LEFT JOIN "NR_CSR"."TBL_KELAYAKAN" K ON P."ID_KELAYAKAN" = K."ID_KELAYAKAN" LEFT JOIN "NR_CSR"."TBL_LEMBAGA" L ON K."ID_LEMBAGA" = L."ID_LEMBAGA" LEFT JOIN "NR_CSR"."TBL_PROKER" PR ON K."ID_PROKER" = PR."ID_PROKER" LEFT JOIN "NR_CSR"."TBL_SURVEI" S ON S."ID_KELAYAKAN" = K."ID_KELAYAKAN"');
        DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_PRIORITAS" AS SELECT "NR_CSR"."TBL_KELAYAKAN"."NO_AGENDA", "NR_CSR"."TBL_KELAYAKAN"."ID_PROKER", "NR_CSR"."TBL_PROKER"."PRIORITAS", "NR_CSR"."TBL_PROKER"."TAHUN", "NR_CSR"."TBL_SURVEI"."NILAI_APPROVED" FROM "NR_CSR"."TBL_KELAYAKAN" INNER JOIN "NR_CSR"."TBL_PROKER" ON "NR_CSR"."TBL_KELAYAKAN"."ID_PROKER" = "NR_CSR"."TBL_PROKER"."ID_PROKER" INNER JOIN "NR_CSR"."TBL_SURVEI" ON "NR_CSR"."TBL_KELAYAKAN"."NO_AGENDA" = "NR_CSR"."TBL_SURVEI"."NO_AGENDA" WHERE "NR_CSR"."TBL_KELAYAKAN"."ID_PROKER" IS NOT NULL AND "NR_CSR"."TBL_PROKER"."PRIORITAS" IS NOT NULL AND "NR_CSR"."TBL_KELAYAKAN"."STATUS" = \'Approved\'');
        // Postgres: TBL_PROKER.ID_INDIKATOR is varchar while TBL_SUB_PILAR.ID_SUB_PILAR is bigint.
        // Cast to text so the join works.
        DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_PROKER" AS SELECT "NR_CSR"."TBL_PROKER"."ID_PROKER", "NR_CSR"."TBL_PROKER"."PROKER", "NR_CSR"."TBL_SUB_PILAR"."PILAR", "NR_CSR"."TBL_SUB_PILAR"."TPB", "NR_CSR"."TBL_PROKER"."ID_INDIKATOR", "NR_CSR"."TBL_SUB_PILAR"."KODE_INDIKATOR", "NR_CSR"."TBL_SUB_PILAR"."KETERANGAN", "NR_CSR"."TBL_PROKER"."TAHUN", "NR_CSR"."TBL_PROKER"."ANGGARAN", "NR_CSR"."TBL_PROKER"."PRIORITAS", "NR_CSR"."TBL_PROKER"."EB" FROM "NR_CSR"."TBL_PROKER" INNER JOIN "NR_CSR"."TBL_SUB_PILAR" ON "NR_CSR"."TBL_PROKER"."ID_INDIKATOR" = ("NR_CSR"."TBL_SUB_PILAR"."ID_SUB_PILAR")::text');
        DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_PROPOSAL" AS SELECT K."ID_KELAYAKAN", K."NO_AGENDA", K."TGL_TERIMA", K."NO_SURAT", K."TGL_SURAT", K."ID_PENGIRIM", P."PENGIRIM", K."SIFAT", K."JENIS", K."ID_PROKER", PR."PROKER", PR."PILAR", PR."KODE_TPB", PR."GOLS", PR."PRIORITAS", K."PERIHAL", K."BANTUAN_UNTUK", K."ID_LEMBAGA", L."NAMA_LEMBAGA", L."NAMA_PIC", L."ALAMAT", L."NO_TELP", L."JABATAN", K."NO_REKENING", K."ATAS_NAMA", K."NAMA_BANK", K."NILAI_PENGAJUAN", K."NILAI_BANTUAN", K."PROVINSI", K."KABUPATEN", K."KECAMATAN", K."KELURAHAN", K."DESKRIPSI", K."YKPP", K."STATUS_YKPP", K."SMAP", K."STATUS", K."EMAIL_PENGAJU", K."CREATED_DATE", K."CREATED_BY", U."NAMA" AS "NAMA_MAKER", U."EMAIL" AS "EMAIL_MAKER", U."JABATAN" AS "JABATAN_MAKER", U."FOTO_PROFILE", K."CHECKLIST_BY", K."CHECKLIST_DATE", K."NOMINAL_APPROVED", K."NOMINAL_FEE", K."TOTAL_YKPP", K."APPROVED_YKPP_BY", K."APPROVED_YKPP_DATE", K."SUBMITED_YKPP_BY", K."SUBMITED_YKPP_DATE", K."NO_SURAT_YKPP", K."TGL_SURAT_YKPP", K."SURAT_YKPP", K."TAHUN_YKPP", K."PENYALURAN_KE" FROM "NR_CSR"."TBL_KELAYAKAN" K LEFT JOIN "NR_CSR"."TBL_PENGIRIM" P ON K."ID_PENGIRIM" = P."ID_PENGIRIM" LEFT JOIN "NR_CSR"."TBL_LEMBAGA" L ON K."ID_LEMBAGA" = L."ID_LEMBAGA" LEFT JOIN "NR_CSR"."TBL_USER" U ON K."CREATED_BY" = U."ID_USER" LEFT JOIN "NR_CSR"."TBL_PROKER" PR ON K."ID_PROKER" = PR."ID_PROKER"');
        DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_PROVINSI_KAMBING" AS SELECT "NR_CSR"."TBL_SUB_PROPOSAL"."PROVINSI" FROM "NR_CSR"."TBL_SUB_PROPOSAL" WHERE "NR_CSR"."TBL_SUB_PROPOSAL"."KAMBING" > 0 GROUP BY "NR_CSR"."TBL_SUB_PROPOSAL"."PROVINSI"');
        DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_PROVINSI_SAPI" AS SELECT "NR_CSR"."TBL_SUB_PROPOSAL"."PROVINSI" FROM "NR_CSR"."TBL_SUB_PROPOSAL" WHERE "NR_CSR"."TBL_SUB_PROPOSAL"."SAPI" > 0 GROUP BY "NR_CSR"."TBL_SUB_PROPOSAL"."PROVINSI"');
        DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_REALISASI_AP" AS SELECT "NR_CSR"."TBL_REALISASI_AP"."ID_REALISASI", "NR_CSR"."TBL_REALISASI_AP"."NO_PROPOSAL", "NR_CSR"."TBL_REALISASI_AP"."TGL_PROPOSAL", "NR_CSR"."TBL_REALISASI_AP"."PENGIRIM", "NR_CSR"."TBL_REALISASI_AP"."TGL_REALISASI", "NR_CSR"."TBL_REALISASI_AP"."SIFAT", "NR_CSR"."TBL_REALISASI_AP"."PERIHAL", "NR_CSR"."TBL_REALISASI_AP"."BESAR_PERMOHONAN", "NR_CSR"."TBL_REALISASI_AP"."KATEGORI", "NR_CSR"."TBL_REALISASI_AP"."NILAI_BANTUAN", "NR_CSR"."TBL_REALISASI_AP"."STATUS", "NR_CSR"."TBL_REALISASI_AP"."PROVINSI", "NR_CSR"."TBL_REALISASI_AP"."KABUPATEN", "NR_CSR"."TBL_REALISASI_AP"."DESKRIPSI", "NR_CSR"."TBL_REALISASI_AP"."ID_PROKER", "NR_CSR"."TBL_REALISASI_AP"."PROKER", "NR_CSR"."TBL_REALISASI_AP"."PILAR", "NR_CSR"."TBL_REALISASI_AP"."GOLS", "NR_CSR"."TBL_REALISASI_AP"."NAMA_YAYASAN", "NR_CSR"."TBL_REALISASI_AP"."ALAMAT", "NR_CSR"."TBL_REALISASI_AP"."PIC", "NR_CSR"."TBL_REALISASI_AP"."JABATAN", "NR_CSR"."TBL_REALISASI_AP"."NO_TELP", "NR_CSR"."TBL_REALISASI_AP"."NO_REKENING", "NR_CSR"."TBL_REALISASI_AP"."ATAS_NAMA", "NR_CSR"."TBL_REALISASI_AP"."NAMA_BANK", "NR_CSR"."TBL_REALISASI_AP"."KOTA_BANK", "NR_CSR"."TBL_REALISASI_AP"."CABANG_BANK", "NR_CSR"."TBL_REALISASI_AP"."CREATED_BY", "NR_CSR"."TBL_REALISASI_AP"."CREATED_DATE", "NR_CSR"."TBL_REALISASI_AP"."JENIS", "NR_CSR"."TBL_REALISASI_AP"."PERUSAHAAN", TO_CHAR("NR_CSR"."TBL_REALISASI_AP"."TGL_REALISASI", \'MM\') AS "BULAN", "NR_CSR"."TBL_REALISASI_AP"."TAHUN", "NR_CSR"."TBL_REALISASI_AP"."STATUS_DATE" FROM "NR_CSR"."TBL_REALISASI_AP"');
        // Depends on V_INV_PAYREQUEST (skipped above when NR_PAYMENT tables do not exist)
        // DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_REALISASI_PROVINSI" AS select account_cad2 from v_inv_payrequest group by account_cad2 order by account_cad2 asc');
        DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_SEKTOR" AS SELECT "NR_CSR"."TBL_KELAYAKAN"."SEKTOR_BANTUAN", COUNT("NR_CSR"."TBL_KELAYAKAN"."SEKTOR_BANTUAN") AS "JUMLAH", TO_CHAR("NR_CSR"."TBL_KELAYAKAN"."TGL_TERIMA", \'YYYY\') as "TAHUN" FROM "NR_CSR"."TBL_KELAYAKAN" GROUP BY "NR_CSR"."TBL_KELAYAKAN"."TGL_TERIMA", "NR_CSR"."TBL_KELAYAKAN"."SEKTOR_BANTUAN"');
        // NOTE: In Postgres schema, TBL_SPK does not contain NO_AGENDA/ID_KELAYAKAN columns,
        // so the original Oracle view definition cannot be recreated 1:1.
        // Provide a simple view that exposes TBL_SPK as-is.
        DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_SPK" AS SELECT "NR_CSR"."TBL_SPK"."SPK_ID", "NR_CSR"."TBL_SPK"."NOMOR", "NR_CSR"."TBL_SPK"."TANGGAL", "NR_CSR"."TBL_SPK"."PEKERJAAN_ID", "NR_CSR"."TBL_SPK"."STATUS", "NR_CSR"."TBL_SPK"."CATATAN", "NR_CSR"."TBL_SPK"."CREATED_BY", "NR_CSR"."TBL_SPK"."CREATED_DATE", "NR_CSR"."TBL_SPK"."ID_VENDOR", "NR_CSR"."TBL_SPK"."FILE_SPK", "NR_CSR"."TBL_SPK"."NILAI_KESEPAKATAN", "NR_CSR"."TBL_SPK"."SPH_ID", "NR_CSR"."TBL_SPK"."BAKN_ID", "NR_CSR"."TBL_SPK"."START_DATE", "NR_CSR"."TBL_SPK"."DUE_DATE", "NR_CSR"."TBL_SPK"."DURASI", "NR_CSR"."TBL_SPK"."RESPONSE_DATE", "NR_CSR"."TBL_SPK"."RESPONSE_BY" FROM "NR_CSR"."TBL_SPK"');
        // Postgres types: TBL_SPPH.PEKERJAAN_ID is numeric, TBL_PEKERJAAN.PEKERJAAN_ID is integer.
        // Also: TBL_SPPH.ID_VENDOR is varchar, TBL_VENDOR.VENDOR_ID is integer.
        // Cast to compatible types for joins.
        DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_SPPH" AS SELECT "NR_CSR"."TBL_SPPH"."SPPH_ID", "NR_CSR"."TBL_SPPH"."NOMOR", "NR_CSR"."TBL_SPPH"."TANGGAL", TO_CHAR("NR_CSR"."TBL_SPPH"."TANGGAL"::timestamp, \'MM\') AS "BULAN", TO_CHAR("NR_CSR"."TBL_SPPH"."TANGGAL"::timestamp, \'YYYY\') AS "TAHUN", "NR_CSR"."TBL_SPPH"."PEKERJAAN_ID", "NR_CSR"."TBL_PEKERJAAN"."NAMA_PEKERJAAN", "NR_CSR"."TBL_SPPH"."STATUS", "NR_CSR"."TBL_SPPH"."CATATAN", "NR_CSR"."TBL_SPPH"."CREATED_BY", "NR_CSR"."TBL_SPPH"."CREATED_DATE", "NR_CSR"."TBL_SPPH"."ID_VENDOR", "NR_CSR"."TBL_SPPH"."FILE_SPPH", "NR_CSR"."TBL_SPPH"."RESPONSE_DATE", "NR_CSR"."TBL_VENDOR"."NAMA_PERUSAHAAN", "NR_CSR"."TBL_PEKERJAAN"."KAK", "NR_CSR"."TBL_PEKERJAAN"."RINGKASAN" FROM "NR_CSR"."TBL_SPPH" INNER JOIN "NR_CSR"."TBL_PEKERJAAN" ON ("NR_CSR"."TBL_SPPH"."PEKERJAAN_ID")::int = "NR_CSR"."TBL_PEKERJAAN"."PEKERJAAN_ID" INNER JOIN "NR_CSR"."TBL_VENDOR" ON ("NR_CSR"."TBL_SPPH"."ID_VENDOR")::int = "NR_CSR"."TBL_VENDOR"."VENDOR_ID"');
        // Depends on V_SURVEI which may not exist (migration creates V_SURVEI later in this file).
        // Skip to keep migrations runnable; can be added after V_SURVEI exists.
        // DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_SUM_SEKTOR" AS ... FROM "NR_CSR"."V_SURVEI" ...');
        // Depends on external schema/tables (NR_PAYMENT.*)
        // DB::statement("CREATE OR REPLACE VIEW \"NR_CSR\".\"V_SUM_SEKTOR2\" AS SELECT ... FROM NR_PAYMENT.T_INVOICE_LINE ..., NR_PAYMENT.T_PAYMENT_REQUEST ...");
        // Depends on external schema/tables (NR_PAYMENT.*)
        // DB::statement("CREATE OR REPLACE VIEW \"NR_CSR\".\"V_SUM_STATUS\" AS SELECT ... FROM NR_PAYMENT.T_INVOICE_LINE ..., NR_PAYMENT.T_PAYMENT_REQUEST ...");
        // NOTE: This view relies on unqualified table names (TBL_*). In Postgres with quoted tables,
        // this breaks unless fully qualified/quoted. Skip for now.
        // DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_SURVEI" AS ...');
        // NOTE: Uses unquoted lowercase identifiers (tbl_user/tbl_role) which won't match our
        // quoted "TBL_USER" / "TBL_ROLE" tables. Skip for now.
        // DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_USER" AS ...');
        // NOTE: Uses unqualified table names (TBL_*). Skip for now.
        // DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_YKPP" AS ...');
        // NOTE: Uses unqualified table names + double-quoted string literals (Postgres requires single quotes).
        // Skip for now.
        // DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_YKPP_ASPIRASI" AS ...');
        // NOTE: Uses unquoted schema/table references + invalid string quoting for Postgres.
        // Skip for now.
        // DB::statement('CREATE OR REPLACE VIEW "NR_CSR"."V_YKPP_SUBMIT" AS ...');

        // (No search_path manipulation required.)
    }

    public function down()
    {
        // Optional: drop views
        // DB::statement('DROP VIEW IF EXISTS ...');
    }
}
